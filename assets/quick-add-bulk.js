customElements.get("quick-add-bulk")||customElements.define("quick-add-bulk",class extends BulkAdd{constructor(){super(),this.quantity=this.querySelector("quantity-input");const t=debounce(s=>{parseInt(s.target.value)===0?this.startQueue(s.target.dataset.index,parseInt(s.target.value)):this.validateQuantity(s)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",t.bind(this)),this.listenForActiveInput(),this.listenForKeydown(),this.lastActiveInputId=null}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,t=>{t.source==="quick-add"||t.cartData.items&&!t.cartData.items.some(s=>s.id===parseInt(this.dataset.index))||t.cartData.variant_id&&t.cartData.variant_id!==parseInt(this.dataset.index)||this.onCartUpdate().then(()=>{this.listenForActiveInput(),this.listenForKeydown()})})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}get input(){return this.querySelector("quantity-input input")}selectProgressBar(){return this.querySelector(".progress-bar-container")}listenForActiveInput(){this.classList.contains("hidden")||this.input?.addEventListener("focusin",t=>t.target.select()),this.isEnterPressed=!1}listenForKeydown(){this.input?.addEventListener("keydown",t=>{t.key==="Enter"&&(this.input?.blur(),this.isEnterPressed=!0)})}cleanErrorMessageOnType(t){t.target.addEventListener("keypress",()=>{t.target.setCustomValidity("")},{once:!0})}get sectionId(){return this._sectionId||(this._sectionId=this.closest(".collection-quick-add-bulk").dataset.id),this._sectionId}onCartUpdate(){return new Promise((t,s)=>{fetch(`${this.getSectionsUrl()}?section_id=${this.sectionId}`).then(e=>e.text()).then(e=>{const i=new DOMParser().parseFromString(e,"text/html").querySelector(`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`);i&&(this.innerHTML=i.innerHTML),t()}).catch(e=>{console.error(e),s(e)})})}getSectionsUrl(){const t=new URLSearchParams(window.location.search),s=decodeURIComponent(t.get("page")||"");return`${window.location.pathname}${s?`?page=${s}`:""}`}updateMultipleQty(t){this.selectProgressBar().classList.remove("hidden");const s=Object.keys(t),e=JSON.stringify({updates:t,sections:this.getSectionsToRender().map(i=>i.section),sections_url:this.getSectionsUrl()});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:e}).then(i=>i.text()).then(i=>{const n=JSON.parse(i);this.renderSections(n,s),publish(PUB_SUB_EVENTS.cartUpdate,{source:"quick-add",cartData:n})}).catch(()=>{}).finally(()=>{this.selectProgressBar().classList.add("hidden"),this.setRequestStarted(!1)})}getSectionsToRender(){return[{id:`quick-add-bulk-${this.dataset.index}-${this.sectionId}`,section:this.sectionId,selector:`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"CartDrawer",selector:".drawer__inner",section:"cart-drawer"}]}renderSections(t,s){this.queue.filter(e=>s.includes(e.id)).length===0&&(this.getSectionsToRender().forEach(e=>{const i=document.getElementById(e.id);e.section==="cart-drawer"&&i.closest("cart-drawer")?.classList.toggle("is-empty",t.items.length.length===0);const n=i&&i.querySelector(e.selector)?i.querySelector(e.selector):i;n&&(n.innerHTML=this.getSectionInnerHTML(t.sections[e.section],e.selector))}),this.isEnterPressed&&this.querySelector(`#Quantity-${this.lastActiveInputId}`).select(),this.listenForActiveInput(),this.listenForKeydown())}});
//# sourceMappingURL=quick-add-bulk.js.map
