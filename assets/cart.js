class E extends HTMLElement{constructor(){super(),this.addEventListener("click",e=>{e.preventDefault(),(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0,e)})}}customElements.define("cart-remove-button",E);class _ extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const e=debounce(t=>{this.onChange(t)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",e.bind(this))}cartUpdateUnsubscriber=void 0;connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,e=>{if(e.source!=="cart-items")return this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}resetQuantityInput(e){const t=this.querySelector(`#Quantity-${e}`);t.value=t.getAttribute("value"),this.isEnterPressed=!1}setValidity(e,t,n){e.target.setCustomValidity(n),e.target.reportValidity(),this.resetQuantityInput(t),e.target.select()}validateQuantity(e){const t=parseInt(e.target.value),n=e.target.dataset.index;let r="";t<e.target.dataset.min?r=window.quickOrderListStrings.min_error.replace("[min]",e.target.dataset.min):t>parseInt(e.target.max)?r=window.quickOrderListStrings.max_error.replace("[max]",e.target.max):t%parseInt(e.target.step)!==0&&(r=window.quickOrderListStrings.step_error.replace("[step]",e.target.step)),r?this.setValidity(e,n,r):(e.target.setCustomValidity(""),e.target.reportValidity(),this.updateQuantity(n,t,e,document.activeElement.getAttribute("name"),e.target.dataset.quantityVariantId))}onChange(e){this.validateQuantity(e)}onCartUpdate(){return this.tagName==="CART-DRAWER-ITEMS"?fetch(`${routes.cart_url}?section_id=cart-drawer`).then(e=>e.text()).then(e=>{const t=new DOMParser().parseFromString(e,"text/html"),n=["cart-drawer-items",".cart-drawer__footer"];for(const r of n){const d=document.querySelector(r),l=t.querySelector(r);d&&l&&d.replaceWith(l)}}).catch(e=>{console.error(e)}):fetch(`${routes.cart_url}?section_id=main-cart-items`).then(e=>e.text()).then(e=>{const t=new DOMParser().parseFromString(e,"text/html").querySelector("cart-items");this.innerHTML=t.innerHTML}).catch(e=>{console.error(e)})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(e,t,n,r,d){this.enableLoading(e);const l=JSON.stringify({line:e,quantity:t,sections:this.getSectionsToRender().map(s=>s.section),sections_url:window.location.pathname}),y=n.currentTarget instanceof E?"clear":"change";fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:l}).then(s=>s.text()).then(s=>{const a=JSON.parse(s);CartPerformance.measure(`${y}:paint-updated-sections"`,()=>{const m=document.getElementById(`Quantity-${e}`)||document.getElementById(`Drawer-quantity-${e}`),I=document.querySelectorAll(".cart-item");if(a.errors){m.value=m.getAttribute("value"),this.updateLiveRegions(e,a.errors);return}this.classList.toggle("is-empty",a.item_count===0);const i=document.querySelector("cart-drawer"),p=document.getElementById("main-cart-footer");p&&p.classList.toggle("is-empty",a.item_count===0),i&&i.classList.toggle("is-empty",a.item_count===0),this.getSectionsToRender().forEach(c=>{const S=document.getElementById(c.id).querySelector(c.selector)||document.getElementById(c.id);S.innerHTML=this.getSectionInnerHTML(a.sections[c.section],c.selector)});const g=a.items[e-1]?a.items[e-1].quantity:void 0;let h="";I.length===a.items.length&&g!==parseInt(m.value)&&(typeof g>"u"?h=window.cartStrings.error:h=window.cartStrings.quantityError.replace("[quantity]",g)),this.updateLiveRegions(e,h);const u=document.getElementById(`CartItem-${e}`)||document.getElementById(`CartDrawer-Item-${e}`);u&&u.querySelector(`[name="${r}"]`)?i?trapFocus(i,u.querySelector(`[name="${r}"]`)):u.querySelector(`[name="${r}"]`).focus():a.item_count===0&&i?trapFocus(i.querySelector(".drawer__inner-empty"),i.querySelector("a")):document.querySelector(".cart-item")&&i&&trapFocus(i,document.querySelector(".cart-item__name"))}),CartPerformance.measureFromEvent(`${y}:user-action`,n),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:a,variantId:d})}).catch(()=>{this.querySelectorAll(".loading__spinner").forEach(a=>a.classList.add("hidden"));const s=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");s.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(e)})}updateLiveRegions(e,t){const n=document.getElementById(`Line-item-error-${e}`)||document.getElementById(`CartDrawer-LineItemError-${e}`);n&&(n.querySelector(".cart-item__error-text").textContent=t),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const r=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");r.setAttribute("aria-hidden",!1),setTimeout(()=>{r.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(e,t){return new DOMParser().parseFromString(e,"text/html").querySelector(t).innerHTML}enableLoading(e){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const t=this.querySelectorAll(`#CartItem-${e} .loading__spinner`),n=this.querySelectorAll(`#CartDrawer-Item-${e} .loading__spinner`);[...t,...n].forEach(r=>r.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(e){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const t=this.querySelectorAll(`#CartItem-${e} .loading__spinner`),n=this.querySelectorAll(`#CartDrawer-Item-${e} .loading__spinner`);t.forEach(r=>r.classList.add("hidden")),n.forEach(r=>r.classList.add("hidden"))}}customElements.define("cart-items",_);customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("input",debounce(o=>{const e=JSON.stringify({note:o.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:e}).then(()=>CartPerformance.measureFromEvent("note-update:user-action",o))},ON_CHANGE_DEBOUNCE_TIMER))}});
//# sourceMappingURL=cart.js.map
