{"version":3,"file":"predictive-search.js","sources":["../theming/js/predictive-search.js"],"sourcesContent":["class c extends SearchForm{constructor(){super(),this.cachedResults={},this.predictiveSearchResults=this.querySelector(\"[data-predictive-search]\"),this.allPredictiveSearchInstances=document.querySelectorAll(\"predictive-search\"),this.isOpen=!1,this.abortController=new AbortController,this.searchTerm=\"\",this.setupEventListeners()}setupEventListeners(){this.input.form.addEventListener(\"submit\",this.onFormSubmit.bind(this)),this.input.addEventListener(\"focus\",this.onFocus.bind(this)),this.addEventListener(\"focusout\",this.onFocusOut.bind(this)),this.addEventListener(\"keyup\",this.onKeyup.bind(this)),this.addEventListener(\"keydown\",this.onKeydown.bind(this))}getQuery(){return this.input.value.trim()}onChange(){super.onChange();const e=this.getQuery();if((!this.searchTerm||!e.startsWith(this.searchTerm))&&this.querySelector(\"#predictive-search-results-groups-wrapper\")?.remove(),this.updateSearchForTerm(this.searchTerm,e),this.searchTerm=e,!this.searchTerm.length){this.close(!0);return}this.getSearchResults(this.searchTerm)}onFormSubmit(e){(!this.getQuery().length||this.querySelector('[aria-selected=\"true\"] a'))&&e.preventDefault()}onFormReset(e){super.onFormReset(e),super.shouldResetForm()&&(this.searchTerm=\"\",this.abortController.abort(),this.abortController=new AbortController,this.closeResults(!0))}onFocus(){const e=this.getQuery();e.length&&(this.searchTerm!==e?this.onChange():this.getAttribute(\"results\")===\"true\"?this.open():this.getSearchResults(this.searchTerm))}onFocusOut(){setTimeout(()=>{this.contains(document.activeElement)||this.close()})}onKeyup(e){switch(this.getQuery().length||this.close(!0),e.preventDefault(),e.code){case\"ArrowUp\":this.switchOption(\"up\");break;case\"ArrowDown\":this.switchOption(\"down\");break;case\"Enter\":this.selectOption();break}}onKeydown(e){(e.code===\"ArrowUp\"||e.code===\"ArrowDown\")&&e.preventDefault()}updateSearchForTerm(e,i){const t=this.querySelector(\"[data-predictive-search-search-for-text]\"),s=t?.innerText;if(s){if(s.match(new RegExp(e,\"g\")).length>1)return;const r=s.replace(e,i);t.innerText=r}}switchOption(e){if(!this.getAttribute(\"open\"))return;const i=e===\"up\",t=this.querySelector('[aria-selected=\"true\"]'),s=Array.from(this.querySelectorAll(\"li, button.predictive-search__item\")).filter(o=>o.offsetParent!==null);let r=0;if(i&&!t)return;let n=-1,h=0;for(;n===-1&&h<=s.length;)s[h]===t&&(n=h),h++;if(this.statusElement.textContent=\"\",!i&&t?r=n===s.length-1?0:n+1:i&&(r=n===0?s.length-1:n-1),r===n)return;const a=s[r];a.setAttribute(\"aria-selected\",!0),t&&t.setAttribute(\"aria-selected\",!1),this.input.setAttribute(\"aria-activedescendant\",a.id)}selectOption(){const e=this.querySelector('[aria-selected=\"true\"] a, button[aria-selected=\"true\"]');e&&e.click()}getSearchResults(e){const i=e.replace(\" \",\"-\").toLowerCase();if(this.setLiveRegionLoadingState(),this.cachedResults[i]){this.renderSearchResults(this.cachedResults[i]);return}fetch(`${routes.predictive_search_url}?q=${encodeURIComponent(e)}&section_id=predictive-search`,{signal:this.abortController.signal}).then(t=>{if(!t.ok){var s=new Error(t.status);throw this.close(),s}return t.text()}).then(t=>{const s=new DOMParser().parseFromString(t,\"text/html\").querySelector(\"#shopify-section-predictive-search\").innerHTML;this.allPredictiveSearchInstances.forEach(r=>{r.cachedResults[i]=s}),this.renderSearchResults(s)}).catch(t=>{if(t?.code!==20)throw this.close(),t})}setLiveRegionLoadingState(){this.statusElement=this.statusElement||this.querySelector(\".predictive-search-status\"),this.loadingText=this.loadingText||this.getAttribute(\"data-loading-text\"),this.setLiveRegionText(this.loadingText),this.setAttribute(\"loading\",!0)}setLiveRegionText(e){this.statusElement.setAttribute(\"aria-hidden\",\"false\"),this.statusElement.textContent=e,setTimeout(()=>{this.statusElement.setAttribute(\"aria-hidden\",\"true\")},1e3)}renderSearchResults(e){this.predictiveSearchResults.innerHTML=e,this.setAttribute(\"results\",!0),this.setLiveRegionResults(),this.open()}setLiveRegionResults(){this.removeAttribute(\"loading\"),this.setLiveRegionText(this.querySelector(\"[data-predictive-search-live-region-count-value]\").textContent)}getResultsMaxHeight(){return this.resultsMaxHeight=window.innerHeight-document.querySelector(\".section-header\")?.getBoundingClientRect().bottom,this.resultsMaxHeight}open(){this.predictiveSearchResults.style.maxHeight=this.resultsMaxHeight||`${this.getResultsMaxHeight()}px`,this.setAttribute(\"open\",!0),this.input.setAttribute(\"aria-expanded\",!0),this.isOpen=!0}close(e=!1){this.closeResults(e),this.isOpen=!1}closeResults(e=!1){e&&(this.input.value=\"\",this.removeAttribute(\"results\"));const i=this.querySelector('[aria-selected=\"true\"]');i&&i.setAttribute(\"aria-selected\",!1),this.input.setAttribute(\"aria-activedescendant\",\"\"),this.removeAttribute(\"loading\"),this.removeAttribute(\"open\"),this.input.setAttribute(\"aria-expanded\",!1),this.resultsMaxHeight=!1,this.predictiveSearchResults.removeAttribute(\"style\")}}customElements.define(\"predictive-search\",c);\n"],"names":["c"],"mappings":"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"}