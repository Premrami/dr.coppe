customElements.get("quick-order-list")||customElements.define("quick-order-list",class extends BulkAdd{cartUpdateUnsubscriber=void 0;hasPendingQuantityUpdate=!1;constructor(){super(),this.isListInsideModal=this.closest("bulk-modal"),this.stickyHeaderElement=document.querySelector("sticky-header"),this.stickyHeaderElement&&(this.stickyHeader={height:this.stickyHeaderElement.offsetHeight,type:`${this.stickyHeaderElement.getAttribute("data-sticky-type")}`}),this.totalBar=this.getTotalBar(),this.totalBar&&(this.totalBarPosition=window.innerHeight-this.totalBar.offsetHeight,this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize)),this.querySelector("form").addEventListener("submit",e=>e.preventDefault())}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,async e=>{e.source!==this.id&&(this.toggleTableLoading(!0),await this.refresh(),this.toggleTableLoading(!1))}),this.initEventListeners()}disconnectedCallback(){this.cartUpdateUnsubscriber?.(),window.removeEventListener("resize",this.handleResize)}handleResize(){this.totalBarPosition=window.innerHeight-this.totalBar.offsetHeight,this.stickyHeader.height=this.stickyHeaderElement?this.stickyHeaderElement.offsetHeight:0}initEventListeners(){this.querySelectorAll(".pagination__item").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();const i=new URL(t.currentTarget.href);this.toggleTableLoading(!0),await this.refresh(i.searchParams.get("page")||"1"),this.scrollTop(),this.toggleTableLoading(!1)})}),this.querySelector(".quick-order-list__contents").addEventListener("keyup",this.handleScrollIntoView.bind(this)),this.quickOrderListTable.addEventListener("keydown",this.handleSwitchVariantOnEnter.bind(this)),this.initVariantEventListeners()}initVariantEventListeners(){this.allInputsArray=Array.from(this.querySelectorAll('input[type="number"]')),this.querySelectorAll("quantity-input").forEach(e=>{const t=debounce(this.onChange.bind(this),BulkAdd.ASYNC_REQUEST_DELAY,!0);e.addEventListener("change",i=>{this.hasPendingQuantityUpdate=!0,t(i)})}),this.querySelectorAll(".quick-order-list-remove-button").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),this.toggleLoading(!0),this.startQueue(e.dataset.index,0)})})}get currentPage(){return this.querySelector(".pagination-wrapper")?.dataset?.page??"1"}get cartVariantsForProduct(){return JSON.parse(this.querySelector("[data-cart-contents]")?.innerHTML||"[]")}onChange(e){const t=parseInt(e.target.value);this.cleanErrorMessageOnType(e),t==0?(e.target.setAttribute("value",t),this.startQueue(e.target.dataset.index,t)):this.validateQuantity(e)}cleanErrorMessageOnType(e){const t=()=>{e.target.setCustomValidity(" "),e.target.reportValidity(),e.target.removeEventListener("keydown",t)};e.target.addEventListener("keydown",t)}validateInput(e){const t=parseInt(e.value),i=parseInt(e.dataset.min),r=parseInt(e.step);return e.max?t==0||t>=i&&t<=parseInt(e.max)&&t%r==0:t==0||t>=i&&t%r==0}get quickOrderListTable(){return this.querySelector(".quick-order-list__table")}getSectionsToRender(){return[{id:this.id,section:this.dataset.section,selector:`#${this.id}`},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:"#shopify-section-cart-icon-bubble"},{id:`quick-order-list-live-region-text-${this.dataset.productId}`,section:"cart-live-region-text",selector:".shopify-section"},{id:"CartDrawer",selector:".drawer__inner",section:"cart-drawer"}]}toggleTableLoading(e){this.quickOrderListTable.classList.toggle("quick-order-list__container--disabled",e),this.toggleLoading(e)}async refresh(e=null){const t=this.dataset.url||window.location.pathname;return fetch(`${t}?section_id=${this.dataset.section}&page=${e||this.currentPage}`).then(i=>i.text()).then(i=>{const r=new DOMParser().parseFromString(i,"text/html").querySelector(`#${this.id}`);r&&(this.innerHTML=r.innerHTML,this.initEventListeners())}).catch(i=>{console.error(i)})}renderSections(e){const{items:t,sections:i}=e;this.getSectionsToRender().forEach(({id:r,selector:n,section:a})=>{const s=document.getElementById(r);if(!s)return;const o=new DOMParser().parseFromString(i[a],"text/html").querySelector(n);if(a===this.dataset.section){if(this.queue.length>0||this.hasPendingQuantityUpdate)return;const c=document.activeElement;let l=c?.dataset?.target;l?.includes("remove")&&(l=c.closest("quantity-popover")?.querySelector('[data-target*="increment-"]')?.dataset.target);const d=this.getTotalBar();d&&(d.innerHTML=o.querySelector(".quick-order-list__total").innerHTML);const g=this.quickOrderListTable,h=o.querySelector(".quick-order-list__table"),p=this.currentPage===(o.querySelector(".pagination-wrapper")?.dataset.page??"1");if(h&&p){g.innerHTML=h.innerHTML;const u=this.querySelector(`[data-target='${l}']`);u&&u?.focus({preventScroll:!0}),this.initVariantEventListeners()}}else a==="cart-drawer"?(s.closest("cart-drawer")?.classList.toggle("is-empty",t.length===0),s.querySelector(n).innerHTML=o.innerHTML):s.innerHTML=o.innerHTML})}getTotalBar(){return this.querySelector(".quick-order-list__total")}scrollTop(){const{top:e}=this.getBoundingClientRect();this.isListInsideModal?this.scrollIntoView():window.scrollTo({top:e+window.scrollY-(this.stickyHeader?.height||0),behavior:"instant"})}scrollQuickOrderListTable(e){const t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;if(this.isListInsideModal){const r=i>this.totalBar.getBoundingClientRect().top,n=t<this.querySelector(".quick-order-list__table thead").getBoundingClientRect().bottom;(r||n)&&this.scrollToCenter(e)}else{const r=this.stickyHeaderElement?.getBoundingClientRect().bottom,n=i>this.totalBarPosition,a=i<this.querySelector(".variant-item__quantity-wrapper").offsetHeight,s=this.stickyHeaderElement&&this.stickyHeader.type!=="on-scroll-up"&&this.stickyHeader.height>t,o=this.stickyHeaderElement&&this.stickyHeader.type==="on-scroll-up"&&this.stickyHeader.height>t&&r>0;(n||a||s||o)&&this.scrollToCenter(e)}}scrollToCenter(e){e.scrollIntoView({block:"center",behavior:"smooth"})}handleScrollIntoView(e){(e.key==="Tab"||e.key==="Enter")&&this.allInputsArray.length!==1&&this.scrollQuickOrderListTable(e.target)}handleSwitchVariantOnEnter(e){if(e.key!=="Enter"||e.target.tagName!=="INPUT"||(e.preventDefault(),e.target.blur(),!this.validateInput(e.target)||this.allInputsArray.length<=1))return;const t=this.allInputsArray.indexOf(e.target),i=e.shiftKey?-1:1,r=(t+i+this.allInputsArray.length)%this.allInputsArray.length;this.allInputsArray[r]?.select()}updateMultipleQty(e){this.queue.length==0&&(this.hasPendingQuantityUpdate=!1),this.toggleLoading(!0);const t=this.dataset.url||window.location.pathname,i=JSON.stringify({updates:e,sections:this.getSectionsToRender().map(({section:r})=>r),sections_url:`${t}?page=${this.currentPage}`});this.updateMessage(),this.setErrorMessage(),fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:i}).then(r=>r.text()).then(async r=>{const n=JSON.parse(r);this.renderSections(n),publish(PUB_SUB_EVENTS.cartUpdate,{source:this.id,cartData:n})}).catch(r=>{console.error(r),this.setErrorMessage(window.cartStrings.error)}).finally(()=>{this.queue.length===0&&this.toggleLoading(!1),this.setRequestStarted(!1)})}setErrorMessage(e=null){this.errorMessageTemplate=this.errorMessageTemplate??document.getElementById(`QuickOrderListErrorTemplate-${this.dataset.productId}`).cloneNode(!0),document.querySelectorAll(".quick-order-list-error").forEach(t=>{if(t.innerHTML="",!e)return;const i=this.errorMessageTemplate.cloneNode(!0);i.content.querySelector(".quick-order-list-error-message").innerText=e,t.appendChild(i.content)})}updateMessage(e=null){const t=this.querySelectorAll(".quick-order-list__message-text"),i=this.querySelectorAll(".quick-order-list__message-icon");if(e===null||isNaN(e)){t.forEach(s=>s.innerHTML=""),i.forEach(s=>s.classList.add("hidden"));return}const r=e<0,n=Math.abs(e),a=r?n===1?window.quickOrderListStrings.itemRemoved:window.quickOrderListStrings.itemsRemoved:e===1?window.quickOrderListStrings.itemAdded:window.quickOrderListStrings.itemsAdded;t.forEach(s=>s.innerHTML=a.replace("[quantity]",n)),r||i.forEach(s=>s.classList.remove("hidden"))}updateError(e,t){let i="";typeof e>"u"?i=window.cartStrings.error:i=window.cartStrings.quantityError.replace("[quantity]",e),this.updateLiveRegions(t,i)}updateLiveRegions(e,t){const i=document.getElementById(`Quick-order-list-item-error-desktop-${e}`);i&&(i.querySelector(".variant-item__error-text").innerHTML=t,i.closest("tr").classList.remove("hidden")),variantItemErrorMobile&&(variantItemErrorMobile.querySelector(".variant-item__error-text").innerHTML=t),this.querySelector("#shopping-cart-variant-item-status").setAttribute("aria-hidden",!0);const r=document.getElementById("quick-order-list-live-region-text");r.setAttribute("aria-hidden",!1),setTimeout(()=>{r.setAttribute("aria-hidden",!0)},1e3)}toggleLoading(e,t=this){t.querySelector("#shopping-cart-variant-item-status").toggleAttribute("aria-hidden",!e),t.querySelectorAll(".variant-remove-total .loading__spinner")?.forEach(i=>i.classList.toggle("hidden",!e))}});customElements.get("quick-order-list-remove-all-button")||customElements.define("quick-order-list-remove-all-button",class extends HTMLElement{constructor(){super(),this.quickOrderList=this.closest("quick-order-list"),this.actions={confirm:"confirm",remove:"remove",cancel:"cancel"},this.addEventListener("click",e=>{if(e.preventDefault(),this.dataset.action===this.actions.confirm)this.toggleConfirmation(!1,!0);else if(this.dataset.action===this.actions.remove){const t=this.quickOrderList.cartVariantsForProduct.reduce((i,r)=>({...i,[r]:0}),{});this.quickOrderList.updateMultipleQty(t),this.toggleConfirmation(!0,!1)}else this.dataset.action===this.actions.cancel&&this.toggleConfirmation(!0,!1)})}toggleConfirmation(e,t){this.quickOrderList.querySelector(".quick-order-list-total__confirmation").classList.toggle("hidden",e),this.quickOrderList.querySelector(".quick-order-list-total__info").classList.toggle("hidden",t)}});
//# sourceMappingURL=quick-order-list.js.map
