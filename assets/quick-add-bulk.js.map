{"version":3,"file":"quick-add-bulk.js","sources":["../theming/js/quick-add-bulk.js"],"sourcesContent":["customElements.get(\"quick-add-bulk\")||customElements.define(\"quick-add-bulk\",class extends BulkAdd{constructor(){super(),this.quantity=this.querySelector(\"quantity-input\");const t=debounce(e=>{parseInt(e.target.value)===0?this.startQueue(e.target.dataset.index,parseInt(e.target.value)):this.validateQuantity(e)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener(\"change\",t.bind(this)),this.listenForActiveInput(),this.listenForKeydown(),this.lastActiveInputId=null}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,t=>{t.source===\"quick-add\"||t.cartData.items&&!t.cartData.items.some(e=>e.id===parseInt(this.dataset.index))||t.cartData.variant_id&&t.cartData.variant_id!==parseInt(this.dataset.index)||this.onCartUpdate().then(()=>{this.listenForActiveInput(),this.listenForKeydown()})})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}get input(){return this.querySelector(\"quantity-input input\")}selectProgressBar(){return this.querySelector(\".progress-bar-container\")}listenForActiveInput(){this.classList.contains(\"hidden\")||this.input?.addEventListener(\"focusin\",t=>t.target.select()),this.isEnterPressed=!1}listenForKeydown(){this.input?.addEventListener(\"keydown\",t=>{t.key===\"Enter\"&&(this.input?.blur(),this.isEnterPressed=!0)})}cleanErrorMessageOnType(t){t.target.addEventListener(\"keypress\",()=>{t.target.setCustomValidity(\"\")},{once:!0})}get sectionId(){return this._sectionId||(this._sectionId=this.closest(\".collection-quick-add-bulk\").dataset.id),this._sectionId}onCartUpdate(){return new Promise((t,e)=>{fetch(`${this.getSectionsUrl()}?section_id=${this.sectionId}`).then(n=>n.text()).then(n=>{const i=new DOMParser().parseFromString(n,\"text/html\").querySelector(`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`);i&&(this.innerHTML=i.innerHTML),t()}).catch(n=>{console.error(n),e(n)})})}getSectionsUrl(){const t=new URLSearchParams(window.location.search),e=decodeURIComponent(t.get(\"page\")||\"\");return`${window.location.pathname}${e?`?page=${e}`:\"\"}`}updateMultipleQty(t){this.selectProgressBar().classList.remove(\"hidden\");const e=Object.keys(t),n=JSON.stringify({updates:t,sections:this.getSectionsToRender().map(s=>s.section),sections_url:this.getSectionsUrl()});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:n}).then(s=>s.text()).then(s=>{const i=JSON.parse(s);this.renderSections(i,e),publish(PUB_SUB_EVENTS.cartUpdate,{source:\"quick-add\",cartData:i})}).catch(()=>{}).finally(()=>{this.selectProgressBar().classList.add(\"hidden\"),this.setRequestStarted(!1)})}getSectionsToRender(){return[{id:`quick-add-bulk-${this.dataset.index}-${this.sectionId}`,section:this.sectionId,selector:`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`},{id:\"cart-icon-bubble\",section:\"cart-icon-bubble\",selector:\".shopify-section\"},{id:\"CartDrawer\",selector:\".drawer__inner\",section:\"cart-drawer\"}]}renderSections(t,e){this.queue.filter(s=>e.includes(s.id)).length===0&&(this.getSectionsToRender().forEach(s=>{const i=document.getElementById(s.id);s.section===\"cart-drawer\"&&i.closest(\"cart-drawer\")?.classList.toggle(\"is-empty\",t.items.length.length===0);const r=i&&i.querySelector(s.selector)?i.querySelector(s.selector):i;r&&(r.innerHTML=this.getSectionInnerHTML(t.sections[s.section],s.selector))}),this.isEnterPressed&&this.querySelector(`#Quantity-${this.lastActiveInputId}`).select(),this.listenForActiveInput(),this.listenForKeydown())}});\n"],"names":["e","n","s","i","r"],"mappings":"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"}