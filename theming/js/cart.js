class E extends HTMLElement{constructor(){super(),this.addEventListener("click",t=>{t.preventDefault(),(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0,t)})}}customElements.define("cart-remove-button",E);class S extends HTMLElement{constructor(){super(),this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const t=debounce(e=>{this.onChange(e)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",t.bind(this))}cartUpdateUnsubscriber=void 0;connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,t=>{if(t.source!=="cart-items")return this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}resetQuantityInput(t){const e=this.querySelector(`#Quantity-${t}`);e.value=e.getAttribute("value"),this.isEnterPressed=!1}setValidity(t,e,a){t.target.setCustomValidity(a),t.target.reportValidity(),this.resetQuantityInput(e),t.target.select()}validateQuantity(t){const e=parseInt(t.target.value),a=t.target.dataset.index;let r="";e<t.target.dataset.min?r=window.quickOrderListStrings.min_error.replace("[min]",t.target.dataset.min):e>parseInt(t.target.max)?r=window.quickOrderListStrings.max_error.replace("[max]",t.target.max):e%parseInt(t.target.step)!==0&&(r=window.quickOrderListStrings.step_error.replace("[step]",t.target.step)),r?this.setValidity(t,a,r):(t.target.setCustomValidity(""),t.target.reportValidity(),this.updateQuantity(a,e,t,document.activeElement.getAttribute("name"),t.target.dataset.quantityVariantId))}onChange(t){this.validateQuantity(t)}onCartUpdate(){return this.tagName==="CART-DRAWER-ITEMS"?fetch(`${routes.cart_url}?section_id=cart-drawer`).then(t=>t.text()).then(t=>{const e=new DOMParser().parseFromString(t,"text/html"),a=["cart-drawer-items",".cart-drawer__footer"];for(const r of a){const s=document.querySelector(r),d=e.querySelector(r);s&&d&&s.replaceWith(d)}}).catch(t=>{console.error(t)}):fetch(`${routes.cart_url}?section_id=main-cart-items`).then(t=>t.text()).then(t=>{const a=new DOMParser().parseFromString(t,"text/html").querySelector("cart-items");this.innerHTML=a.innerHTML}).catch(t=>{console.error(t)})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(t,e,a,r,s){this.enableLoading(t);const d=JSON.stringify({line:t,quantity:e,sections:this.getSectionsToRender().map(c=>c.section),sections_url:window.location.pathname}),y=a.currentTarget instanceof E?"clear":"change";fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:d}).then(c=>c.text()).then(c=>{const n=JSON.parse(c);CartPerformance.measure(`${y}:paint-updated-sections"`,()=>{const u=document.getElementById(`Quantity-${t}`)||document.getElementById(`Drawer-quantity-${t}`),I=document.querySelectorAll(".cart-item");if(n.errors){u.value=u.getAttribute("value"),this.updateLiveRegions(t,n.errors);return}this.classList.toggle("is-empty",n.item_count===0);const i=document.querySelector("cart-drawer"),p=document.getElementById("main-cart-footer");p&&p.classList.toggle("is-empty",n.item_count===0),i&&i.classList.toggle("is-empty",n.item_count===0),this.getSectionsToRender().forEach(o=>{const f=document.getElementById(o.id).querySelector(o.selector)||document.getElementById(o.id);f.innerHTML=this.getSectionInnerHTML(n.sections[o.section],o.selector)});const l=n.items[t-1]?n.items[t-1].quantity:void 0;let g="";I.length===n.items.length&&l!==parseInt(u.value)&&(typeof l>"u"?g=window.cartStrings.error:g=window.cartStrings.quantityError.replace("[quantity]",l)),this.updateLiveRegions(t,g);const m=document.getElementById(`CartItem-${t}`)||document.getElementById(`CartDrawer-Item-${t}`);m&&m.querySelector(`[name="${r}"]`)?i?trapFocus(i,m.querySelector(`[name="${r}"]`)):m.querySelector(`[name="${r}"]`).focus():n.item_count===0&&i?trapFocus(i.querySelector(".drawer__inner-empty"),i.querySelector("a")):document.querySelector(".cart-item")&&i&&trapFocus(i,document.querySelector(".cart-item__name"))}),CartPerformance.measureFromEvent(`${y}:user-action`,a),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:n,variantId:s})}).catch(()=>{this.querySelectorAll(".loading__spinner").forEach(n=>n.classList.add("hidden"));const c=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");c.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(t)})}updateLiveRegions(t,e){const a=document.getElementById(`Line-item-error-${t}`)||document.getElementById(`CartDrawer-LineItemError-${t}`);a&&(a.querySelector(".cart-item__error-text").textContent=e),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const r=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");r.setAttribute("aria-hidden",!1),setTimeout(()=>{r.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(t,e){return new DOMParser().parseFromString(t,"text/html").querySelector(e).innerHTML}enableLoading(t){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const a=this.querySelectorAll(`#CartItem-${t} .loading__spinner`),r=this.querySelectorAll(`#CartDrawer-Item-${t} .loading__spinner`);[...a,...r].forEach(s=>s.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(t){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const a=this.querySelectorAll(`#CartItem-${t} .loading__spinner`),r=this.querySelectorAll(`#CartDrawer-Item-${t} .loading__spinner`);a.forEach(s=>s.classList.add("hidden")),r.forEach(s=>s.classList.add("hidden"))}}customElements.define("cart-items",S);customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("input",debounce(t=>{const e=JSON.stringify({note:t.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:e}).then(()=>CartPerformance.measureFromEvent("note-update:user-action",t))},ON_CHANGE_DEBOUNCE_TIMER))}});
