customElements.get("product-info")||customElements.define("product-info",class extends HTMLElement{quantityInput=void 0;quantityForm=void 0;onVariantChangeUnsubscriber=void 0;cartUpdateUnsubscriber=void 0;abortController=void 0;pendingRequestUrl=null;preProcessHtmlCallbacks=[];postProcessHtmlCallbacks=[];constructor(){super(),this.quantityInput=this.querySelector(".quantity__input")}connectedCallback(){this.initializeProductSwapUtility(),this.onVariantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.optionValueSelectionChange,this.handleOptionValueChange.bind(this)),this.initQuantityHandlers(),this.dispatchEvent(new CustomEvent("product-info:loaded",{bubbles:!0}))}addPreProcessCallback(e){this.preProcessHtmlCallbacks.push(e)}initQuantityHandlers(){this.quantityInput&&(this.quantityForm=this.querySelector(".product-form__quantity"),this.quantityForm&&(this.setQuantityBoundries(),this.dataset.originalSection||(this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,this.fetchQuantityRules.bind(this)))))}disconnectedCallback(){this.onVariantChangeUnsubscriber(),this.cartUpdateUnsubscriber?.()}initializeProductSwapUtility(){this.preProcessHtmlCallbacks.push(e=>e.querySelectorAll(".scroll-trigger").forEach(t=>t.classList.add("scroll-trigger--cancel"))),this.postProcessHtmlCallbacks.push(e=>{window?.Shopify?.PaymentButton?.init(),window?.ProductModel?.loadShopifyXR()})}handleOptionValueChange({data:{event:e,target:t,selectedOptionValues:i}}){if(!this.contains(e.target))return;this.resetProductFormState();const a=t.dataset.productUrl||this.pendingRequestUrl||this.dataset.url;this.pendingRequestUrl=a;const r=this.dataset.url!==a,o=this.dataset.updateUrl==="true"&&r;this.renderProductInfo({requestUrl:this.buildRequestUrlWithParams(a,i,o),targetId:t.id,callback:r?this.handleSwapProduct(a,o):this.handleUpdateProductInfo(a)})}resetProductFormState(){const e=this.productForm;e?.toggleSubmitButton(!0),e?.handleErrorMessage()}handleSwapProduct(e,t){return i=>{this.productModal?.remove();const a=t?"product-info[id^='MainProduct']":"product-info",r=this.getSelectedVariant(i.querySelector(a));this.updateURL(e,r?.id),t?(document.querySelector("head title").innerHTML=i.querySelector("head title").innerHTML,HTMLUpdateUtility.viewTransition(document.querySelector("main"),i.querySelector("main"),this.preProcessHtmlCallbacks,this.postProcessHtmlCallbacks)):HTMLUpdateUtility.viewTransition(this,i.querySelector("product-info"),this.preProcessHtmlCallbacks,this.postProcessHtmlCallbacks)}}renderProductInfo({requestUrl:e,targetId:t,callback:i}){this.abortController?.abort(),this.abortController=new AbortController,fetch(e,{signal:this.abortController.signal}).then(a=>a.text()).then(a=>{this.pendingRequestUrl=null;const r=new DOMParser().parseFromString(a,"text/html");i(r)}).then(()=>{document.querySelector(`#${t}`)?.focus()}).catch(a=>{a.name==="AbortError"?console.log("Fetch aborted by user"):console.error(a)})}getSelectedVariant(e){const t=e.querySelector("variant-selects [data-selected-variant]")?.innerHTML;return t?JSON.parse(t):null}buildRequestUrlWithParams(e,t,i=!1){const a=[];return!i&&a.push(`section_id=${this.sectionId}`),t.length&&a.push(`option_values=${t.join(",")}`),`${e}?${a.join("&")}`}updateOptionValues(e){const t=e.querySelector("variant-selects");t&&HTMLUpdateUtility.viewTransition(this.variantSelectors,t,this.preProcessHtmlCallbacks)}handleUpdateProductInfo(e){return t=>{const i=this.getSelectedVariant(t);if(this.pickupAvailability?.update(i),this.updateOptionValues(t),this.updateURL(e,i?.id),this.updateVariantInputs(i?.id),!i){this.setUnavailable();return}this.updateMedia(t,i?.featured_media?.id);const a=(r,o=u=>!1)=>{const u=t.getElementById(`${r}-${this.sectionId}`),n=this.querySelector(`#${r}-${this.dataset.section}`);u&&n&&(n.innerHTML=u.innerHTML,n.classList.toggle("hidden",o(u)))};a("price"),a("Sku",({classList:r})=>r.contains("hidden")),a("Inventory",({innerText:r})=>r===""),a("Volume"),a("Price-Per-Item",({classList:r})=>r.contains("hidden")),this.updateQuantityRules(this.sectionId,t),this.querySelector(`#Quantity-Rules-${this.dataset.section}`)?.classList.remove("hidden"),this.querySelector(`#Volume-Note-${this.dataset.section}`)?.classList.remove("hidden"),this.productForm?.toggleSubmitButton(t.getElementById(`ProductSubmitButton-${this.sectionId}`)?.hasAttribute("disabled")??!0,window.variantStrings.soldOut),publish(PUB_SUB_EVENTS.variantChange,{data:{sectionId:this.sectionId,html:t,variant:i}})}}updateVariantInputs(e){this.querySelectorAll(`#product-form-${this.dataset.section}, #product-form-installment-${this.dataset.section}`).forEach(t=>{const i=t.querySelector('input[name="id"]');i.value=e??"",i.dispatchEvent(new Event("change",{bubbles:!0}))})}updateURL(e,t){this.querySelector("share-button")?.updateUrl(`${window.shopUrl}${e}${t?`?variant=${t}`:""}`),this.dataset.updateUrl!=="false"&&window.history.replaceState({},"",`${e}${t?`?variant=${t}`:""}`)}setUnavailable(){this.productForm?.toggleSubmitButton(!0,window.variantStrings.unavailable);const e=["price","Inventory","Sku","Price-Per-Item","Volume-Note","Volume","Quantity-Rules"].map(t=>`#${t}-${this.dataset.section}`).join(", ");document.querySelectorAll(e).forEach(({classList:t})=>t.add("hidden"))}updateMedia(e,t){if(!t)return;const i=this.querySelector("media-gallery ul"),a=e.querySelector("media-gallery ul"),r=()=>{this.hasAttribute("data-zoom-on-hover")&&enableZoomOnHover(2);const n=Array.from(i.querySelectorAll("li[data-media-id]")),d=new Set(n.map(c=>c.dataset.mediaId)),l=new Map(n.map((c,h)=>[c.dataset.mediaId,{item:c,index:h}]));return[n,d,l]};if(i&&a){let[n,d,l]=r();const c=Array.from(a.querySelectorAll("li[data-media-id]")),h=new Set(c.map(({dataset:s})=>s.mediaId));let p=!1;for(let s=c.length-1;s>=0;s--)d.has(c[s].dataset.mediaId)||(i.prepend(c[s]),p=!0);for(let s=0;s<n.length;s++)h.has(n[s].dataset.mediaId)||(n[s].remove(),p=!0);p&&([n,d,l]=r()),c.forEach((s,y)=>{const m=l.get(s.dataset.mediaId);m&&m.index!==y&&(i.insertBefore(m.item,i.querySelector(`li:nth-of-type(${y+1})`)),[n,d,l]=r())})}this.querySelector("media-gallery")?.setActiveMedia?.(`${this.dataset.section}-${t}`,!0);const o=this.productModal?.querySelector(".product-media-modal__content"),u=e.querySelector("product-modal .product-media-modal__content");o&&u&&(o.innerHTML=u.innerHTML)}setQuantityBoundries(){const e={cartQuantity:this.quantityInput.dataset.cartQuantity?parseInt(this.quantityInput.dataset.cartQuantity):0,min:this.quantityInput.dataset.min?parseInt(this.quantityInput.dataset.min):1,max:this.quantityInput.dataset.max?parseInt(this.quantityInput.dataset.max):null,step:this.quantityInput.step?parseInt(this.quantityInput.step):1};let t=e.min;const i=e.max===null?e.max:e.max-e.cartQuantity;i!==null&&(t=Math.min(t,i)),e.cartQuantity>=e.min&&(t=Math.min(t,e.step)),this.quantityInput.min=t,i?this.quantityInput.max=i:this.quantityInput.removeAttribute("max"),this.quantityInput.value=t,publish(PUB_SUB_EVENTS.quantityUpdate,void 0)}fetchQuantityRules(){const e=this.productForm?.variantIdInput?.value;if(e)return this.querySelector(".quantity__rules-cart .loading__spinner").classList.remove("hidden"),fetch(`${this.dataset.url}?variant=${e}&section_id=${this.dataset.section}`).then(t=>t.text()).then(t=>{const i=new DOMParser().parseFromString(t,"text/html");this.updateQuantityRules(this.dataset.section,i)}).catch(t=>console.error(t)).finally(()=>this.querySelector(".quantity__rules-cart .loading__spinner").classList.add("hidden"))}updateQuantityRules(e,t){if(!this.quantityInput)return;this.setQuantityBoundries();const i=t.getElementById(`Quantity-Form-${e}`),a=[".quantity__input",".quantity__rules",".quantity__label"];for(let r of a){const o=this.quantityForm.querySelector(r),u=i.querySelector(r);if(!(!o||!u))if(r===".quantity__input"){const n=["data-cart-quantity","data-min","data-max","step"];for(let d of n){const l=u.getAttribute(d);l!==null?o.setAttribute(d,l):o.removeAttribute(d)}}else o.innerHTML=u.innerHTML}}get productForm(){return this.querySelector("product-form")}get productModal(){return document.querySelector(`#ProductModal-${this.dataset.section}`)}get pickupAvailability(){return this.querySelector("pickup-availability")}get variantSelectors(){return this.querySelector("variant-selects")}get relatedProducts(){const e=SectionId.getIdForSection(SectionId.parseId(this.sectionId),"related-products");return document.querySelector(`product-recommendations[data-section-id^="${e}"]`)}get quickOrderList(){const e=SectionId.getIdForSection(SectionId.parseId(this.sectionId),"quick_order_list");return document.querySelector(`quick-order-list[data-id^="${e}"]`)}get sectionId(){return this.dataset.originalSection||this.dataset.section}});
