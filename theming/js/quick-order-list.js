customElements.get("quick-order-list")||customElements.define("quick-order-list",class extends BulkAdd{cartUpdateUnsubscriber=void 0;hasPendingQuantityUpdate=!1;constructor(){super(),this.isListInsideModal=this.closest("bulk-modal"),this.stickyHeaderElement=document.querySelector("sticky-header"),this.stickyHeaderElement&&(this.stickyHeader={height:this.stickyHeaderElement.offsetHeight,type:`${this.stickyHeaderElement.getAttribute("data-sticky-type")}`}),this.totalBar=this.getTotalBar(),this.totalBar&&(this.totalBarPosition=window.innerHeight-this.totalBar.offsetHeight,this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize)),this.querySelector("form").addEventListener("submit",t=>t.preventDefault())}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,async t=>{t.source!==this.id&&(this.toggleTableLoading(!0),await this.refresh(),this.toggleTableLoading(!1))}),this.initEventListeners()}disconnectedCallback(){this.cartUpdateUnsubscriber?.(),window.removeEventListener("resize",this.handleResize)}handleResize(){this.totalBarPosition=window.innerHeight-this.totalBar.offsetHeight,this.stickyHeader.height=this.stickyHeaderElement?this.stickyHeaderElement.offsetHeight:0}initEventListeners(){this.querySelectorAll(".pagination__item").forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();const i=new URL(e.currentTarget.href);this.toggleTableLoading(!0),await this.refresh(i.searchParams.get("page")||"1"),this.scrollTop(),this.toggleTableLoading(!1)})}),this.querySelector(".quick-order-list__contents").addEventListener("keyup",this.handleScrollIntoView.bind(this)),this.quickOrderListTable.addEventListener("keydown",this.handleSwitchVariantOnEnter.bind(this)),this.initVariantEventListeners()}initVariantEventListeners(){this.allInputsArray=Array.from(this.querySelectorAll('input[type="number"]')),this.querySelectorAll("quantity-input").forEach(t=>{const e=debounce(this.onChange.bind(this),BulkAdd.ASYNC_REQUEST_DELAY,!0);t.addEventListener("change",i=>{this.hasPendingQuantityUpdate=!0,e(i)})}),this.querySelectorAll(".quick-order-list-remove-button").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),this.toggleLoading(!0),this.startQueue(t.dataset.index,0)})})}get currentPage(){return this.querySelector(".pagination-wrapper")?.dataset?.page??"1"}get cartVariantsForProduct(){return JSON.parse(this.querySelector("[data-cart-contents]")?.innerHTML||"[]")}onChange(t){const e=parseInt(t.target.value);this.cleanErrorMessageOnType(t),e==0?(t.target.setAttribute("value",e),this.startQueue(t.target.dataset.index,e)):this.validateQuantity(t)}cleanErrorMessageOnType(t){const e=()=>{t.target.setCustomValidity(" "),t.target.reportValidity(),t.target.removeEventListener("keydown",e)};t.target.addEventListener("keydown",e)}validateInput(t){const e=parseInt(t.value),i=parseInt(t.dataset.min),r=parseInt(t.step);return t.max?e==0||e>=i&&e<=parseInt(t.max)&&e%r==0:e==0||e>=i&&e%r==0}get quickOrderListTable(){return this.querySelector(".quick-order-list__table")}getSectionsToRender(){return[{id:this.id,section:this.dataset.section,selector:`#${this.id}`},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:"#shopify-section-cart-icon-bubble"},{id:`quick-order-list-live-region-text-${this.dataset.productId}`,section:"cart-live-region-text",selector:".shopify-section"},{id:"CartDrawer",selector:".drawer__inner",section:"cart-drawer"}]}toggleTableLoading(t){this.quickOrderListTable.classList.toggle("quick-order-list__container--disabled",t),this.toggleLoading(t)}async refresh(t=null){const e=this.dataset.url||window.location.pathname;return fetch(`${e}?section_id=${this.dataset.section}&page=${t||this.currentPage}`).then(i=>i.text()).then(i=>{const s=new DOMParser().parseFromString(i,"text/html").querySelector(`#${this.id}`);s&&(this.innerHTML=s.innerHTML,this.initEventListeners())}).catch(i=>{console.error(i)})}renderSections(t){const{items:e,sections:i}=t;this.getSectionsToRender().forEach(({id:r,selector:s,section:a})=>{const n=document.getElementById(r);if(!n)return;const o=new DOMParser().parseFromString(i[a],"text/html").querySelector(s);if(a===this.dataset.section){if(this.queue.length>0||this.hasPendingQuantityUpdate)return;const c=document.activeElement;let l=c?.dataset?.target;l?.includes("remove")&&(l=c.closest("quantity-popover")?.querySelector('[data-target*="increment-"]')?.dataset.target);const d=this.getTotalBar();d&&(d.innerHTML=o.querySelector(".quick-order-list__total").innerHTML);const p=this.quickOrderListTable,u=o.querySelector(".quick-order-list__table"),m=this.currentPage===(o.querySelector(".pagination-wrapper")?.dataset.page??"1");if(u&&m){p.innerHTML=u.innerHTML;const h=this.querySelector(`[data-target='${l}']`);h&&h?.focus({preventScroll:!0}),this.initVariantEventListeners()}}else a==="cart-drawer"?(n.closest("cart-drawer")?.classList.toggle("is-empty",e.length===0),n.querySelector(s).innerHTML=o.innerHTML):n.innerHTML=o.innerHTML})}getTotalBar(){return this.querySelector(".quick-order-list__total")}scrollTop(){const{top:t}=this.getBoundingClientRect();this.isListInsideModal?this.scrollIntoView():window.scrollTo({top:t+window.scrollY-(this.stickyHeader?.height||0),behavior:"instant"})}scrollQuickOrderListTable(t){const e=t.getBoundingClientRect().top,i=t.getBoundingClientRect().bottom;if(this.isListInsideModal){const r=i>this.totalBar.getBoundingClientRect().top,s=e<this.querySelector(".quick-order-list__table thead").getBoundingClientRect().bottom;(r||s)&&this.scrollToCenter(t)}else{const r=this.stickyHeaderElement?.getBoundingClientRect().bottom,s=i>this.totalBarPosition,a=i<this.querySelector(".variant-item__quantity-wrapper").offsetHeight,n=this.stickyHeaderElement&&this.stickyHeader.type!=="on-scroll-up"&&this.stickyHeader.height>e,o=this.stickyHeaderElement&&this.stickyHeader.type==="on-scroll-up"&&this.stickyHeader.height>e&&r>0;(s||a||n||o)&&this.scrollToCenter(t)}}scrollToCenter(t){t.scrollIntoView({block:"center",behavior:"smooth"})}handleScrollIntoView(t){(t.key==="Tab"||t.key==="Enter")&&this.allInputsArray.length!==1&&this.scrollQuickOrderListTable(t.target)}handleSwitchVariantOnEnter(t){if(t.key!=="Enter"||t.target.tagName!=="INPUT"||(t.preventDefault(),t.target.blur(),!this.validateInput(t.target)||this.allInputsArray.length<=1))return;const e=this.allInputsArray.indexOf(t.target),i=t.shiftKey?-1:1,r=(e+i+this.allInputsArray.length)%this.allInputsArray.length;this.allInputsArray[r]?.select()}updateMultipleQty(t){this.queue.length==0&&(this.hasPendingQuantityUpdate=!1),this.toggleLoading(!0);const e=this.dataset.url||window.location.pathname,i=JSON.stringify({updates:t,sections:this.getSectionsToRender().map(({section:r})=>r),sections_url:`${e}?page=${this.currentPage}`});this.updateMessage(),this.setErrorMessage(),fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:i}).then(r=>r.text()).then(async r=>{const s=JSON.parse(r);this.renderSections(s),publish(PUB_SUB_EVENTS.cartUpdate,{source:this.id,cartData:s})}).catch(r=>{console.error(r),this.setErrorMessage(window.cartStrings.error)}).finally(()=>{this.queue.length===0&&this.toggleLoading(!1),this.setRequestStarted(!1)})}setErrorMessage(t=null){this.errorMessageTemplate=this.errorMessageTemplate??document.getElementById(`QuickOrderListErrorTemplate-${this.dataset.productId}`).cloneNode(!0),document.querySelectorAll(".quick-order-list-error").forEach(i=>{if(i.innerHTML="",!t)return;const r=this.errorMessageTemplate.cloneNode(!0);r.content.querySelector(".quick-order-list-error-message").innerText=t,i.appendChild(r.content)})}updateMessage(t=null){const e=this.querySelectorAll(".quick-order-list__message-text"),i=this.querySelectorAll(".quick-order-list__message-icon");if(t===null||isNaN(t)){e.forEach(n=>n.innerHTML=""),i.forEach(n=>n.classList.add("hidden"));return}const r=t<0,s=Math.abs(t),a=r?s===1?window.quickOrderListStrings.itemRemoved:window.quickOrderListStrings.itemsRemoved:t===1?window.quickOrderListStrings.itemAdded:window.quickOrderListStrings.itemsAdded;e.forEach(n=>n.innerHTML=a.replace("[quantity]",s)),r||i.forEach(n=>n.classList.remove("hidden"))}updateError(t,e){let i="";typeof t>"u"?i=window.cartStrings.error:i=window.cartStrings.quantityError.replace("[quantity]",t),this.updateLiveRegions(e,i)}updateLiveRegions(t,e){const i=document.getElementById(`Quick-order-list-item-error-desktop-${t}`);i&&(i.querySelector(".variant-item__error-text").innerHTML=e,i.closest("tr").classList.remove("hidden")),variantItemErrorMobile&&(variantItemErrorMobile.querySelector(".variant-item__error-text").innerHTML=e),this.querySelector("#shopping-cart-variant-item-status").setAttribute("aria-hidden",!0);const r=document.getElementById("quick-order-list-live-region-text");r.setAttribute("aria-hidden",!1),setTimeout(()=>{r.setAttribute("aria-hidden",!0)},1e3)}toggleLoading(t,e=this){e.querySelector("#shopping-cart-variant-item-status").toggleAttribute("aria-hidden",!t),e.querySelectorAll(".variant-remove-total .loading__spinner")?.forEach(i=>i.classList.toggle("hidden",!t))}});customElements.get("quick-order-list-remove-all-button")||customElements.define("quick-order-list-remove-all-button",class extends HTMLElement{constructor(){super(),this.quickOrderList=this.closest("quick-order-list"),this.actions={confirm:"confirm",remove:"remove",cancel:"cancel"},this.addEventListener("click",t=>{if(t.preventDefault(),this.dataset.action===this.actions.confirm)this.toggleConfirmation(!1,!0);else if(this.dataset.action===this.actions.remove){const e=this.quickOrderList.cartVariantsForProduct.reduce((i,r)=>({...i,[r]:0}),{});this.quickOrderList.updateMultipleQty(e),this.toggleConfirmation(!0,!1)}else this.dataset.action===this.actions.cancel&&this.toggleConfirmation(!0,!1)})}toggleConfirmation(t,e){this.quickOrderList.querySelector(".quick-order-list-total__confirmation").classList.toggle("hidden",t),this.quickOrderList.querySelector(".quick-order-list-total__info").classList.toggle("hidden",e)}});
