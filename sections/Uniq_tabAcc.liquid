{{ 'Uniq_tabAcc.css' | asset_url | stylesheet_tag }}

{% assign categories = '' %}
{% for block in section.blocks %}
  {% assign cat_handle = block.settings.category | handleize %}
  {% unless categories contains cat_handle %}
    {% assign categories = categories | append: cat_handle | append: ',' %}
  {% endunless %}
{% endfor %}

{% assign unique_categories = categories | split: ',' | uniq %}

{% if section.blocks.size > 0 %}
  <div class="page-width">
    <div class="faq-wrapper">
      <!-- Tabs -->
      <div class="faq-tabs">
        {% for cat in unique_categories %}
          {% unless cat == '' %}
            <button class="faq-tab {% if forloop.first %}active{% endif %}" data-tab="{{ cat }}">
              {{ cat | replace: '-', ' ' | capitalize }}
            </button>
          {% endunless %}
        {% endfor %}
      </div>

      <!-- Accordions by category -->
      {% for cat in unique_categories %}
        {% unless cat == '' %}
          <div class="faq-accordion-group {% if forloop.first %}active{% endif %}" data-tab="{{ cat }}">
            {% for block in section.blocks %}
              {% assign block_category = block.settings.category | handleize %}
              {% if block_category == cat %}
                <div class="faq-accordion-item">
                  <button class="faq-question">
                    {{ block.settings.title }}
                    <svg width="18" height="11" viewBox="0 0 18 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" clip-rule="evenodd" d="M8.46778 0.823141C8.76068 0.530241 9.23548 0.530241 9.52838 0.823141L17.1749 8.46964C17.4678 8.76254 17.4678 9.23734 17.1749 9.53024L16.8213 9.88384C16.5284 10.1767 16.0535 10.1767 15.7606 9.88384L8.99808 3.12124L2.23548 9.88384C1.94258 10.1767 1.46778 10.1767 1.17488 9.88384L0.821283 9.53024C0.528383 9.23734 0.528383 8.76254 0.821283 8.46964L8.46778 0.823141Z" fill="black"/>
                      <path d="M1.88184 9.53027C1.78419 9.62787 1.62594 9.6279 1.52832 9.53027L1.1748 9.17676C1.07718 9.07913 1.07721 8.92088 1.1748 8.82324L8.82129 1.17676C8.91893 1.07912 9.07717 1.07912 9.1748 1.17676L16.8213 8.82324C16.9189 8.92088 16.9189 9.07912 16.8213 9.17676L16.4678 9.53027C16.3702 9.62789 16.2119 9.62789 16.1143 9.53027L8.99805 2.41406L1.88184 9.53027Z" stroke="black" stroke-opacity="0.3"/>
                    </svg>
                  </button>
                  <div class="faq-answer">
                    {{ block.settings.description }}
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endunless %}
      {% endfor %}
    </div>
  </div>
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".faq-tab");
    const groups = document.querySelectorAll(".faq-accordion-group");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const tabName = tab.dataset.tab;
        tabs.forEach(t => t.classList.remove("active"));
        groups.forEach(g => g.classList.remove("active"));

        tab.classList.add("active");
        document.querySelector(`.faq-accordion-group[data-tab="${tabName}"]`).classList.add("active");
      });
    });

    const questions = document.querySelectorAll(".faq-question");
    questions.forEach(q => {
      q.addEventListener("click", () => {
        const answer = q.nextElementSibling;
        q.classList.toggle("open");
        answer.classList.toggle("open");
      });
    });
  });
</script>

{% schema %}
{
  "name": "Tabbed FAQ",
  "settings": [],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "category",
          "label": "Category"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Question"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Answer"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tabbed FAQ",
      "category": "FAQ"
    }
  ]
}
{% endschema %}
